<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>f2py_wrapper_gen — Fortran 90 source code wrapping &mdash; quippy  documentation</title>
    
    <link rel="stylesheet" href="_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="quippy  documentation" href="index.html" />
    <link rel="up" title="Appendix: wrapping Fortran 90 Code" href="fortran_wrapper.html" />
    <link rel="next" title="patch_f2py — modify numpy.f2py at runtime" href="patch_f2py.html" />
    <link rel="prev" title="f90doc — Fortran 90 source code scanner" href="f90doc.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="patch_f2py.html" title="patch_f2py — modify numpy.f2py at runtime"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="f90doc.html" title="f90doc — Fortran 90 source code scanner"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">quippy  documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="fortran_wrapper.html" accesskey="U">Appendix: wrapping Fortran 90 Code</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/hybrid.png" alt="Logo"/>
            </a></p>
  <h4>Previous topic</h4>
  <p class="topless"><a href="f90doc.html"
                        title="previous chapter"><code class="docutils literal"><span class="pre">f90doc</span></code> &#8212; Fortran 90 source code scanner</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="patch_f2py.html"
                        title="next chapter"><code class="docutils literal"><span class="pre">patch_f2py</span></code> &#8212; modify <code class="docutils literal"><span class="pre">numpy.f2py</span></code> at runtime</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/f2py_wrapper_gen.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="module-f2py_wrapper_gen">
<span id="f2py-wrapper-gen-fortran-90-source-code-wrapping"></span><h1><a class="reference internal" href="#module-f2py_wrapper_gen" title="f2py_wrapper_gen: Generate simplified Fortran 90 source suitable for f2py"><code class="xref py py-mod docutils literal"><span class="pre">f2py_wrapper_gen</span></code></a> &#8212; Fortran 90 source code wrapping<a class="headerlink" href="#module-f2py_wrapper_gen" title="Permalink to this headline">¶</a></h1>
<p>This module is used to write intermediary Fortran 90 wrapper files
to allow a code which makes use of derived types to be wrapped with f2py.</p>
<p>All routines which accept derived types arguments are wrapped by
equivalent routines which instead accept integer arrays as opaque
handles.  The Fortran <cite>transfer()</cite> intrinsic is used to convert these
handles into pointers to derived types, as described in
<a class="reference internal" href="intro.html#pletzer2008" id="id1">[Pletzer2008]</a>. Using integer arrays of size 12 makes this approach
portable across most currently available Fortran compilers. In this
way we can access the underlying Fortran structures from Python.</p>
<p><code class="xref c c-func docutils literal"><span class="pre">initialise()</span></code> and <code class="xref c c-func docutils literal"><span class="pre">finalise()</span></code> routines are handled
specially: on initialisation, a derived type pointer is allocated
before the wrapped routine is invoked, and an opaque reference to this
new derived type is returned. On finalisation the underlying
derived type pointer is deallocated after the wrapped routine returns.</p>
<p>Extra routines are generated to access the values of attributes
within derived types. For scalars a pair of get and set routines is
created, whilst for arrays a single routine which returns the shape,
memory location and type of the array is output. These routines are
used by <a class="reference internal" href="oo_fortran.html#module-quippy.oo_fortran" title="quippy.oo_fortran: Fortran 90 derived-type support"><code class="xref py py-mod docutils literal"><span class="pre">quippy.oo_fortran</span></code></a> when constructing the object-oriented
wrapper layer.</p>
<p>There are various other special cases which are handled individually: for
details see the
<a class="reference external" href="http://src.tcm.phy.cam.ac.uk//viewvc/jrk33/repo/trunk/QUIP/Tools/quippy/f2py_wrapper_gen.py?view=markup">source code</a>.</p>
<p>This module defines a single function:</p>
<dl class="function">
<dt id="f2py_wrapper_gen.wrap_mod">
<code class="descclassname">f2py_wrapper_gen.</code><code class="descname">wrap_mod</code><span class="sig-paren">(</span><em>mod</em>, <em>type_map</em><span class="optional">[</span>, <em>out</em>, <em>kindlines</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#f2py_wrapper_gen.wrap_mod" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>mod</strong> &#8211; <code class="xref py py-class docutils literal"><span class="pre">f90doc.C_module</span></code> instance</li>
<li><strong>type_map</strong> &#8211; dictionary</li>
<li><strong>out</strong> &#8211; file-like object or None</li>
<li><strong>kindlines</strong> &#8211; list of strings</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last"><a class="reference internal" href="dictionary.html#module-quippy.dictionary" title="quippy.dictionary: Fortran dictionary for storing key/value pairs">dictionary</a></p>
</td>
</tr>
</tbody>
</table>
<p>Write a Fortran 90 wrapper file for the module <cite>mod</cite> to the file <cite>out</cite>.
Returns a specification dictionary describing the interface which has been
created.</p>
<p><cite>type_map</cite> should be a dictionary mapping Fortran derived-type
names to the names of the Fortran modules in which they are defined.</p>
<p><cite>kind_lines</cite> is a list of strings to be included near the top of
the generated module to import any Fortran kind definitions that are needed
from other modules.</p>
<p>The <cite>spec</cite> dictionary returned by this function is combined with those
of other modules and saved to disk by quippy&#8217;s <code class="file docutils literal"><span class="pre">setup.py</span></code> script.</p>
</dd></dl>

</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="patch_f2py.html" title="patch_f2py — modify numpy.f2py at runtime"
             >next</a> |</li>
        <li class="right" >
          <a href="f90doc.html" title="f90doc — Fortran 90 source code scanner"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">quippy  documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="fortran_wrapper.html" >Appendix: wrapping Fortran 90 Code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2008-2015, James Kermode.
      Last updated on Aug 08, 2015.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>